guess = list(b"ABCDEFGHIJKLMNOPQRSTUVWXYZ123456")

# xor_shift_thing_caller
for i in range(0, len(guess)):
    b = ((guess[i] * 2) & 0xaa) | ((guess[i] >> 1) & 0x55)
    guess[i] = b

# Read from program memory
swapped = [0xa5, 0xa3, 0xa0, 0x85, 0x89, 0x84, 0xa2, 0xa6, 0xa9, 0x87, 0x8b, 0x33, 0x32, 0x8d, 0xa4, 0x83, 0x86, 0xa8, 0x8c, 0x39, 0x82, 0x8a, 0xaa, 0x38, 0x81, 0xab, 0x8f, 0x31, 0x3a, 0xa1, 0x88, 0x8e]

shuf_map = {}
for i, c in enumerate(guess):
    shuf_map[i] = swapped.index(c)

guess1 = list(b"ABCDEFGHIJKLMNOPQRSTUVWXYZ123456")
guess_out1 = [0xedaefdd5, 0xba6103bd, 0x1186fc89, 0x4fc8314, 0x4f59d312, 0x4c6f6e28, 0xb9c65cd2, 0x464902e, 0xed3f1f80, 0xe788911c, 0xe7197349, 0x3cd56ab, 0x3f7235d9 , 0xb0d68d21, 0xee09a2ba, 0x1807cf2, 0xe42fce73 , 0xee9840ef, 0xb371d24e, 0x6b8b768, 0x1ba09040 , 0xe4be2c26, 0x46d8e0b4, 0x682c29e, 0xb0476f74 , 0x457fbfdb, 0x18962d7a, 0x9495cae, 0xc06c89bf , 0x1221a3e6, 0x4cfe8c7d, 0x1b31721]
guess2 = list(b"abcdefghijklmnopqrstuvwxyz7890{}")
guess_out2 = [0xbc9d9b9c, 0xeb5265f4, 0x40b59ac0, 0x1efb570, 0x1e6ab55b, 0x1d5c0861, 0xe8f53a9b, 0x177a64a, 0xbc0c79c9, 0xb6bbf755, 0xb62a1500, 0xc0fd6be, 0xc3cbd6d0 , 0xe1e5eb68, 0xbf3ac4f3, 0x4934a96, 0xb51ca83a , 0xbfab26a6, 0xe242b407, 0xe864d8c, 0x4a93f609 , 0xb58d4a6f, 0x17eb86fd, 0x9732958, 0xe174093d , 0x144cd992, 0x49a54b33, 0x68bdcbb, 0x14dd3bc7 , 0x4312c5af, 0x1dcdea34, 0x4a02145]
guess3 = list(b"!@#$%^&*()_+-=[]\'\":;,.\\|?<>/`~aa") #!@#$%^&*()_+-=[]'":;,.\|?<>/`~aa
guess_out3 = [0x97a377d7, 0x6b1a94de, 0xb957be87, 0x629ba77, 0x12b041b3, 0xc97c584c, 0x61ad1a42, 0x3c4488e, 0x3662e42a, 0xbaf0e1e8, 0xc9edba19, 0xe2d3565, 0x940428b8 , 0x3fe3d78c, 0x40247895, 0x9eb3a62, 0xcadb0723 , 0xc35a3485, 0x613cf817, 0x4a93f60, 0x9d14f94b , 0x620a452d, 0x35c5bb45, 0x438327f, 0xb3e0301b , 0x11171edc, 0x45ee5d8e, 0x9e22447, 0x4a93f609 , 0x36f3067f, 0xca4ae576, 0x9d851b1]
guess4 = list(b"!\"#$%&'()*+,-./0123456789:;<=>?@") # !"#$%&'()*+,-./0123456789:;<=>?@
guess_out4 = [0x6b1a94de, 0x3cd56ab6, 0x97329582, 0xc97c584, 0xc9edba19, 0xcadb0723, 0x3f7235d9, 0xc0fd6be, 0x6b8b768b, 0x613cf817, 0x61ad1a42, 0x3fe3d78, 0xc35a3485 , 0x3662e42a, 0x68bdcbb1, 0x9eb3a62, 0x629ba778 , 0x682c29e4, 0x35c5bb45, 0xb3e0301, 0x9d14f94b , 0x620a452d, 0xc06c89bf, 0x940428b, 0x36f3067f , 0xc3cbd6d0, 0x9e224471, 0x97a377d, 0x3c4488e3 , 0x9495caed, 0xca4ae576, 0x9d851b1]

guess6 = list(b"abcdefghijklmnopqrstuvwxyz{|}~ A") # abcdefghijklmnopqrstuvwxyz{|}~ A
guess_out6 = [0xbc9d9b9c, 0xeb5265f4, 0x40b59ac0, 0x1efb570, 0x1e6ab55b, 0x1d5c0861, 0xe8f53a9b, 0x177a64a, 0xbc0c79c9, 0xb6bbf755, 0xb62a1500, 0xe864d8c, 0x14dd3bc7 , 0xe1e5eb68, 0xbf3ac4f3, 0x4934a96, 0xb51ca83a , 0xbfab26a6, 0xe242b407, 0x1ba0904, 0x4a93f609 , 0xb58d4a6f, 0x17eb86fd, 0x438327f, 0xe174093d , 0x144cd992, 0x49a54b33, 0x4024789, 0x35545910 , 0x4312c5af, 0x1dcdea34, 0x4a02145]
guess7 = list(b"`_^]\\[ZYXWVUTSRQPONMLKJIHGFEDCBA") # `_^]\[ZYXWVUTSRQPONMLKJIHGFEDCBA
guess_out7 = [0xe7197349, 0xb0d68d21, 0xb9c65cd2, 0x457fbfd, 0x45ee5d8e, 0x464902e1, 0x1186fc89, 0x4c6f6e2, 0xe788911c, 0xed3f1f80, 0xedaefdd5, 0x4cfe8c7, 0x4f59d312 , 0xba6103bd, 0xe42fce73, 0x12b041b, 0xee09a2ba , 0x1b317215, 0x46d8e0b4, 0x1ba0904, 0xe2d35652 , 0x11171edc, 0xb371d24e, 0x1807cf2, 0xbaf0e1e8 , 0x4fc83147, 0x1221a3e6, 0xe4be2c2, 0xb0476f74 , 0x18962d7a, 0xb957be87, 0xee9840e]
guess8 = list(b"}{0987zyxwvutsrqponmlkjihgfedcba")
guess_out8 = [0xb62a1500, 0xe1e5eb68, 0xe8f53a9b, 0x144cd99, 0xc3cbd6d0, 0x177a64a8, 0x40b59ac0, 0x1d5c086, 0xb6bbf755, 0xbc0c79c9, 0xbc9d9b9c, 0x1dcdea3, 0x1e6ab55b , 0xeb5265f4, 0xb51ca83a, 0x9732958, 0xbf3ac4f3 , 0x4a02145c, 0x17eb86fd, 0x4a93f60, 0xe864d8ce , 0x68bdcbb1, 0xe242b407, 0x4934a96, 0x14dd3bc7 , 0x1efb570e, 0x4312c5af, 0xb58d4a6, 0xe174093d , 0x49a54b33, 0xc0fd6bea, 0xbfab26a]
guess9 = list(b"@?>=<;:9876543210/.-,+*)(\'&%$#\"!") # @?>=<;:9876543210/.-,+*)('&%$#"!
guess_out9 = [0x61ad1a42, 0x3662e42a, 0x3f7235d9, 0xc3cbd6d, 0xc35a3485, 0xc0fd6bea, 0x97329582, 0xcadb072, 0x613cf817, 0x6b8b768b, 0x6b1a94de, 0xca4ae57, 0xc9edba19 , 0x3cd56ab6, 0x629ba778, 0x940428b, 0x68bdcbb1 , 0x9d851b1e, 0xc06c89bf, 0x9d14f94, 0xb3e0301b , 0x97a377d7, 0x35c5bb45, 0x9eb3a62, 0x3c4488e3 , 0xc97c584c, 0x9495caed, 0x620a452, 0x36f3067f , 0x9e224471, 0x3fe3d78c, 0x682c29e]

def make_map(guess, guess_out):
    full_map = {}
    for (k, v) in shuf_map.items():
        full_map[guess_out[v]] = chr(guess[k])
        #full_map[chr(guess[k])] = hex(guess_out[v])
    return full_map

full_map = {}
full_map.update(make_map(guess1, guess_out1))
full_map.update(make_map(guess2, guess_out2))
full_map.update(make_map(guess3, guess_out3))
full_map.update(make_map(guess4, guess_out4))
full_map.update(make_map(guess6, guess_out6))
full_map.update(make_map(guess7, guess_out7))
full_map.update(make_map(guess8, guess_out8))
full_map.update(make_map(guess9, guess_out9))

target = [0xb62a1500, 0x1d5c0861, 0x4c6f6e28, 0x4312c5a, 0x3cd56ab6, 0x1e6ab55b, 0x3cd56ab6, 0xc06c89b, 0xed3f1f80, 0xbaf0e1e8, 0xbfab26a6, 0x3cd56ab, 0xb3e0301b , 0xbaf0e1e8, 0xe1e5eb68, 0xb0476f7, 0xb3e0301b , 0x3cd56ab6, 0xbfab26a6, 0xe864d8c, 0x4c6f6e28 , 0x4312c5af, 0xb3e0301b, 0x9d14f94, 0xee9840ef , 0x3cd56ab6, 0xbfab26a6, 0xbfab26a, 0x9d14f94b , 0xbaf0e1e8, 0x14dd3bc7, 0x9732958, 0x85a0a3a5, 0xa6a28489, 0x338b87a9, 0x83a48d3, 0x398ca886 , 0x38aa8a82, 0x318fab81, 0x8e88a13]

#x = ['H', 'T', '0xb0476f7', '{', 'r', '0x3cd56ab6', 't', 'f', '@', '0x4312c5a', '_', 't', '0', '_', 't', 'H', '0x3cd56ab6', '_', 'h', '0x3cd56ab6', '@', 'V', '0x3cd56ab6', 'n', '0xc06c89b', 'g', '@', '0xbfab26a', '3', '0x9d14f94', '!', '}']
full_map[0xb0476f7] = 'B'

flag = []
for c in target:
    if full_map.get(c):
        flag.append(full_map[c])
    else:
        #flag.append(hex(c))
        flag.append('X')

new_flag = ""
new_guess = [''] * 32
for (k, v) in shuf_map.items():
    new_guess[k] = flag[v]
print(new_guess)
print(''.join(new_guess))
